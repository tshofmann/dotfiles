#!/usr/bin/env zsh
# ============================================================
# pre-commit - Git Hook f√ºr Dokumentations-Validierung
# ============================================================
# Zweck   : Pr√ºft Docs-Synchronisation vor jedem Commit
# Install : ./setup/install-hooks.sh
# ============================================================

# Pfad zum dotfiles-Verzeichnis (relativ zum Hook)
DOTFILES_DIR="$(git rev-parse --show-toplevel)"

# Nur pr√ºfen wenn docs/ oder relevante Code-Dateien ge√§ndert wurden
changed_files=$(git diff --cached --name-only)

needs_check=false
if echo "$changed_files" | grep -qE '^(docs/|setup/Brewfile|terminal/.config/)'; then
    needs_check=true
fi

if [[ "$needs_check" == "true" ]]; then
    echo "üìñ Pr√ºfe Dokumentations-Synchronisation..."
    
    if ! "$DOTFILES_DIR/setup/validate-docs.sh"; then
        echo ""
        echo "‚ùå Commit abgebrochen: Dokumentation stimmt nicht mit Code √ºberein!"
        echo ""
        echo "Optionen:"
        echo "  1. Dokumentation aktualisieren und erneut committen"
        echo "  2. Hook √ºberspringen: git commit --no-verify"
        exit 1
    fi
fi

exit 0
