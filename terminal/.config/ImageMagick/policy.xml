<?xml version="1.0" encoding="UTF-8"?>
<!-- ============================================================
     ImageMagick Security Policy
     ============================================================
     Zweck   : Sichere Standardkonfiguration f체r ImageMagick
     Pfad    : ~/.config/ImageMagick/policy.xml
     Docs    : https://imagemagick.org/script/security-policy.php
     ============================================================
     Diese Policy beschr채nkt ImageMagick auf sichere Bildformate
     und blockiert bekannte Angriffsvektoren (CVE-2025-57807 etc.)
     ============================================================ -->
<!DOCTYPE policymap [
  <!ELEMENT policymap (policy)*>
  <!ATTLIST policymap xmlns CDATA #FIXED "">
  <!ELEMENT policy EMPTY>
  <!ATTLIST policy xmlns CDATA #FIXED "" domain CDATA #REQUIRED
    name CDATA #IMPLIED pattern CDATA #IMPLIED rights CDATA #IMPLIED
    stealth CDATA #IMPLIED value CDATA #IMPLIED>
]>
<policymap>
  <!-- ============================================================
       Erlaubte Formate (f체r yazi-Preview und normale Nutzung)
       ============================================================ -->
  <policy domain="coder" rights="read|write" pattern="{JPEG,JPG,PNG,GIF,WEBP,HEIC,HEIF,AVIF,JXL,BMP,TIFF,TIF}" />
  <policy domain="coder" rights="read" pattern="{TTF,OTF,WOFF,WOFF2}" />
  <policy domain="coder" rights="read" pattern="SVG" />

  <!-- ============================================================
       Blockierte Netzwerk-Protokolle (Remote Code Execution)
       ============================================================ -->
  <policy domain="coder" rights="none" pattern="{URL,HTTP,HTTPS,FTP,FTPS}" />

  <!-- ============================================================
       Blockierte Scripting-Formate (Arbitrary Code Execution)
       ============================================================ -->
  <policy domain="coder" rights="none" pattern="{MVG,MSL}" />

  <!-- ============================================================
       Blockierte Delegate-Formate (Shell Injection)
       ============================================================ -->
  <policy domain="coder" rights="none" pattern="{PS,PS2,PS3,EPS,EPSI,EPSF,PDF,XPS}" />
  <policy domain="coder" rights="none" pattern="{EPHEMERAL,MIFF,SHOW,WIN}" />

  <!-- ============================================================
       Delegates komplett deaktivieren (externe Programme)
       ============================================================ -->
  <policy domain="delegate" rights="none" pattern="*" />

  <!-- ============================================================
       Indirect reads blockieren (@-Syntax f체r Dateilisten)
       ============================================================ -->
  <policy domain="path" rights="none" pattern="@*" />

  <!-- ============================================================
       Ressourcen-Limits (DoS-Schutz)
       ============================================================ -->
  <policy domain="resource" name="memory" value="256MiB" />
  <policy domain="resource" name="map" value="512MiB" />
  <policy domain="resource" name="disk" value="1GiB" />
  <policy domain="resource" name="width" value="16KP" />
  <policy domain="resource" name="height" value="16KP" />
  <policy domain="resource" name="area" value="128MP" />
  <policy domain="resource" name="thread" value="4" />
  <policy domain="resource" name="time" value="120" />

  <!-- ============================================================
       System-Policies
       ============================================================ -->
  <policy domain="system" name="shred" value="2" />
  <policy domain="system" name="max-memory-request" value="256MiB" />
</policymap>
